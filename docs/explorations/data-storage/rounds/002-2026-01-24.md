# Round 2 - 2026-01-24

Based on the research, **better-sqlite3 with WAL mode** is the recommended solution. A few implementation details to confirm:

---

## 1. Data Location Migration

You said data should live in `~/.time-tracker/`. Should we:

- **A) Migrate now** - Move data from `./data/` to `~/.time-tracker/` as part of this change
- **B) Migrate later** - Keep `./data/` for now, change location in a separate task
- **C) Support both** - Check `~/.time-tracker/` first, fall back to `./data/`

**Your answer:**
A

---

## 2. Existing Data Migration

Current databases were created with sql.js. How to handle existing data?

- **A) Auto-migrate** - Detect sql.js format, convert automatically on first run
- **B) Manual migration** - Provide a script users can run
- **C) Fresh start** - Existing data is lost (activity can be re-collected anyway)

Note: sql.js databases are standard SQLite format, so they should work directly with better-sqlite3.

**Your answer:**
C

---

## 3. Database Architecture

Currently there are two databases: `activity.db` and `config.db`. With better-sqlite3's proper file locking, we could:

- **A) Keep two databases** - Maintains current separation (daemon writes activity, server writes config)
- **B) Merge to one** - Single `timetracker.db` with all tables (simpler, WAL handles concurrency)

**Your answer:**
B, If we are sure concurrency and race conditions will not be an issue

---

## 4. Settings in Database vs File

Research suggests keeping settings in SQLite is simpler. But you mentioned B/C (YAML/JSON) seemed good. Final preference?

- **A) Keep in SQLite** - Simpler, transactional, current approach works
- **B) Extract to YAML** - Human-readable, easy manual editing
- **C) Extract to JSON** - Similar to YAML, no external dependency

Note: If staying with SQLite, no code changes needed for settings. If extracting, it's additional work but provides a nice config file users can back up separately.

**Your answer:**
A

---

## 5. Implementation Approach

How should we approach the migration?

- **A) Big bang** - Replace sql.js with better-sqlite3 in one PR
- **B) Phased** - First add better-sqlite3 alongside sql.js, then switch, then remove sql.js
- **C) New branch** - Develop on a feature branch, merge when stable

**Your answer:**
C. This tool is stil in early development, so we can allow our selves to move in big steps and without keeping legacy. But DO branch out and PR when we are done

---
